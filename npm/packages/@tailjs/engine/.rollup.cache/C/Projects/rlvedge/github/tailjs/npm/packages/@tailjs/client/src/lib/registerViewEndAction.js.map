{"version":3,"file":"registerViewEndAction.js","sourceRoot":"","sources":["registerViewEndAction.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,sBAAsB,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,EAAE,MAAM,GAAG,CAAC;AAIpE,4DAA4D;AAC5D,MAAM,aAAa,GAAG,OAAO,EAAuB,CAAC;AAErD,IAAI,QAAQ,GAAG,CAAC,CAAC;AAEjB,MAAM,CAAC,MAAM,UAAU,GAAwB,GAAG,EAAE,GAAE,CAAC,CAAC;AAExD,MAAM,CAAC,MAAM,mBAAmB,GAAG,GAAG,EAAE;IACtC,QAAQ,GAAG,CAAC,CAAC;IACb,GAAG,CAAC,aAAa,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACxC,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,qBAAqB,GAAG,CACnC,MAAkC,EACb,EAAE;IACvB,MAAM,OAAO,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE,EAAE,CAC7B,GAAG,CAAC,aAAa,EAAE,OAAO,CAAC,IAAI,MAAM,IAAI,MAAM,CAAC,QAAQ,CAAC,CAAC;IAE5D,aAAa,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IAE3B,OAAO,OAAO,CAAC;AACjB,CAAC,CAAC;AAEF,sBAAsB,CAAC,GAAG,EAAE,CAAC,mBAAmB,EAAE,CAAC,CAAC","sourcesContent":["import { F, T, addTerminationListener, del, hashSet, map } from \".\";\n\nexport type PendingActionHandle = (commit?: boolean) => void;\n\n// These will be flushed when / if the user leaves the page.\nconst activeHandles = hashSet<PendingActionHandle>();\n\nlet flushing = F;\n\nexport const noopAction: PendingActionHandle = () => {};\n\nexport const flushViewEndActions = () => {\n  flushing = T;\n  map(activeHandles, (item) => item(T));\n};\n\nexport const registerViewEndAction = (\n  action: (flushed: boolean) => void\n): PendingActionHandle => {\n  const handler = (commit = T) =>\n    del(activeHandles, handler) && commit && action(flushing);\n\n  activeHandles.add(handler);\n\n  return handler;\n};\n\naddTerminationListener(() => flushViewEndActions());\n"]}