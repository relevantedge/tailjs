{"version":3,"file":"TargetedVariableMap.test.js","sourceRoot":"","sources":["TargetedVariableMap.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { VariableScope } from \"@tailjs/types\";\r\nimport { map } from \"@tailjs/util\";\r\nimport { TargetedVariableCollection } from \"../src/storage/TargetedVariableMap\";\r\n\r\ndescribe(\"TargetedVariableMap\", () => {\r\n  it(\"Can get items, and add items if an initializer is provided..\", () => {\r\n    const variables = new TargetedVariableCollection<number>();\r\n\r\n    expect(\r\n      variables.get({ scope: \"device\", key: \"test\", targetId: \"t1\" })\r\n    ).toBeUndefined();\r\n    expect(\r\n      variables.get({ scope: \"device\", key: \"test\", targetId: \"t1\" }, () => 10)\r\n    ).toBe(10);\r\n    expect(\r\n      variables.get({ scope: \"device\", key: \"test\", targetId: \"t1\" })\r\n    ).toBe(10);\r\n\r\n    expect(\r\n      variables.get({ scope: \"device\", key: \"test\", targetId: \"t2\" })\r\n    ).toBeUndefined();\r\n    expect(\r\n      variables.get({ scope: \"device\", key: \"test2\", targetId: \"t1\" })\r\n    ).toBeUndefined();\r\n    expect(\r\n      variables.get({ scope: \"session\", key: \"test\", targetId: \"t1\" })\r\n    ).toBeUndefined();\r\n\r\n    expect(variables.size).toBe(1);\r\n\r\n    expect(\r\n      variables.get({ scope: \"device\", key: \"test\", targetId: \"t2\" }, () => 2)\r\n    ).toBe(2);\r\n    expect(\r\n      variables.get({ scope: \"session\", key: \"test\", targetId: \"t1\" }, () => 3)\r\n    ).toBe(3);\r\n\r\n    expect(variables.get(\"t1\").size).toBe(2);\r\n    expect(variables.get(\"t2\").size).toBe(1);\r\n    expect(variables.get(\"t3\")?.size).toBeUndefined();\r\n    expect(variables.size).toBe(3);\r\n\r\n    expect(\r\n      variables.has({ scope: \"device\", key: \"test\", targetId: \"t2\" })\r\n    ).toBe(true);\r\n    expect(\r\n      variables.has({ scope: \"device\", key: \"test\", targetId: \"t3\" })\r\n    ).toBe(false);\r\n\r\n    expect(map(variables)).toEqual([\r\n      [{ scope: VariableScope.Device, key: \"test\", targetId: \"t1\" }, 10],\r\n      [{ scope: VariableScope.Session, key: \"test\", targetId: \"t1\" }, 3],\r\n      [{ scope: VariableScope.Device, key: \"test\", targetId: \"t2\" }, 2],\r\n    ]);\r\n\r\n    expect([...variables.targets(true)]).toEqual([\"t1\", \"t2\"]);\r\n    expect(\r\n      [...variables.targets()].map(([key, value]) => [key, value.size])\r\n    ).toEqual([\r\n      [\"t1\", 2],\r\n      [\"t2\", 1],\r\n    ]);\r\n  });\r\n\r\n  it(\"Sets\", () => {\r\n    const variables = new TargetedVariableCollection<number>();\r\n\r\n    expect(\r\n      variables.get({ scope: \"entity\", key: \"abc\", targetId: \"t1\" })\r\n    ).toBeUndefined();\r\n    variables.set(\r\n      { scope: VariableScope.Entity, key: \"abc\", targetId: \"t1\" },\r\n      10\r\n    );\r\n    expect(variables.get({ scope: \"entity\", key: \"abc\", targetId: \"t1\" })).toBe(\r\n      10\r\n    );\r\n\r\n    expect(\r\n      variables.update(\r\n        { scope: \"device\", key: \"abc\", targetId: \"t1\" },\r\n        (current) => (current ?? -1) + 1\r\n      )\r\n    ).toBe(0);\r\n\r\n    expect(\r\n      variables.update(\r\n        { scope: \"device\", key: \"abc\", targetId: \"t1\" },\r\n        (current) => current! + 1\r\n      )\r\n    ).toBe(1);\r\n    expect(\r\n      variables.update(\r\n        { scope: \"device\", key: \"abc\", targetId: \"t1\" },\r\n        (current) => current! + 10\r\n      )\r\n    ).toBe(11);\r\n\r\n    expect(variables.size).toBe(2);\r\n\r\n    variables.clear();\r\n    expect(variables.size).toBe(0);\r\n  });\r\n});\r\n"]}