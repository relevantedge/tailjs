{"version":3,"file":"dom.js","sourceRoot":"","sources":["dom.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  cast,\n  type Domain,\n  type Position,\n  type Rectangle,\n  type ScreenPosition,\n  type Size,\n  type Viewport,\n} from \"@tailjs/types\";\nimport type {\n  ConstToNormal,\n  Nullish,\n  Nulls,\n  ValueOrDefault,\n} from \"@tailjs/util\";\nimport {\n  body,\n  document,\n  entries,\n  err,\n  F,\n  filter,\n  fun,\n  lowerCase,\n  map,\n  match,\n  MAX_SAFE_INTEGER,\n  nil,\n  parseBoolean,\n  push,\n  replace,\n  round,\n  T,\n  undefined,\n  window,\n} from \".\";\n\nexport type NodeWithParentElement = Node | EventTarget | Nullish;\n\nexport let MAX_ANCESTOR_DISTANCE = MAX_SAFE_INTEGER;\n\nexport const forAncestorsOrSelf = <T = any>(\n  el: NodeWithParentElement,\n  action: (\n    el: Element,\n    returnValue: (value: T, replace?: boolean) => void,\n    distance: number\n  ) => any,\n  stoppingCriterion: (el: Element, distance: number) => boolean = (\n    el,\n    distance\n  ) => distance >= MAX_ANCESTOR_DISTANCE\n): T | undefined => {\n  let i = 0,\n    returnValue: any,\n    stop = F;\n  while (\n    el?.[\"nodeType\"] === 1 &&\n    !stoppingCriterion(el as Element, i++) &&\n    action(\n      el as Element,\n      (value, replace) => (\n        value != nil &&\n          ((returnValue = value), (stop = replace !== T && returnValue != nil)),\n        T\n      ),\n      i - 1\n    ) !== F &&\n    !stop\n  ) {\n    const prev = el;\n    el = (el as Element).parentElement;\n    if (el === nil && (prev as Element)?.ownerDocument !== document) {\n      el = (prev as Element)?.ownerDocument.defaultView?.frameElement;\n    }\n  }\n\n  return returnValue;\n};\n\nexport const inElementScope = (node: NodeWithParentElement, name: string) =>\n  forAncestorsOrSelf(node, (el, value) =>\n    value(tagName(el) === name || undefined)\n  );\n\nexport const scopeAttr = (node: NodeWithParentElement, name: string) =>\n  forAncestorsOrSelf(node, (el, value) => value(attr(el, name)));\n\nexport const attrl = (node: NodeWithParentElement, name: string) =>\n  lowerCase(attr(node, name));\n\nlet value: string | null;\nexport const attrb = (node: NodeWithParentElement, name: string) =>\n  (value = attr(node, name)) === \"\" || parseBoolean(value);\n\nexport const attrn = (node: NodeWithParentElement, name: string) =>\n  parseFloat(\"\" + (value = attr(node, name))) ?? undefined;\n\nexport const attrs = <T extends NodeWithParentElement | Nullish>(\n  node: T\n): string[] | Nulls<T, undefined> => (node as any)?.getAttributeNames();\n\nexport const attr = (\n  node: NodeWithParentElement,\n  name: string,\n  value?: string | null\n): string | null =>\n  !(node as any)?.getAttribute\n    ? nil\n    : value === undefined\n    ? (node as Element).getAttribute(name)\n    : (value === nil\n        ? (node as any).removeAttribute(name)\n        : (node as any).setAttribute(name, value),\n      value);\n\nexport const cssProperty = (el: Element, name: string) =>\n  getComputedStyle(el).getPropertyValue(name) || nil;\n\nlet parameters: {};\nexport const define = <\n  T,\n  P extends Record<keyof any, [any, boolean?] | undefined>\n>(\n  target: T,\n  props: P\n): T & P =>\n  ((parameters = {}),\n  (map(\n    filter(entries(props), ([_, value]) => value != nil),\n    ([name, [value, writable = F] = []]) =>\n      (parameters[name] = {\n        writable,\n        configurable: writable,\n        value,\n      })\n  ),\n  Object.defineProperties(target, parameters))) as any;\n\nexport const tagName = <T extends Element | Nullish>(\n  el: T\n): T extends Nullish ? null : string => (el != nil ? (el.tagName as any) : nil);\n\nlet pos: Position;\nexport const relativeScrollPos = (): Position => (\n  (pos = scrollPos(F)),\n  {\n    x: pos.x / (body.offsetWidth - window.innerWidth) || 0,\n    y: pos.y / (body.offsetHeight - window.innerHeight) || 0,\n  }\n);\n\nexport const scrollPos = (int?: boolean): Position => ({\n  x: round(scrollX, int),\n  y: round(scrollY, int),\n});\n\nexport const matchExHash = (href1: string, href2: string) =>\n  replace(href1, /#.*$/, \"\") === replace(href2, /#.*$/, \"\");\n\nlet screenPos: Position | undefined;\nexport const getScreenPos = <T extends Element | Nullish>(\n  el: T,\n  mouseEvent?: MouseEvent,\n  includeFold = T\n): ScreenPosition | Nulls<T> =>\n  (screenPos = getPos(el, mouseEvent)) &&\n  (cast<ScreenPosition>({\n    xpx: screenPos.x,\n    ypx: screenPos.y,\n    x: round(screenPos.x / body.offsetWidth, 4),\n    y: round(screenPos.y / body.offsetHeight, 4),\n    pageFolds: includeFold ? screenPos.y / window.innerHeight : undefined,\n  }) as any);\n\nlet x: number, y: number;\nexport const getPos = <T extends Element | Nullish>(\n  el: T,\n  mouseEvent?: MouseEvent\n): ValueOrDefault<T, Position> =>\n  !!mouseEvent?.[\"pointerType\"] && mouseEvent?.pageY != nil\n    ? { x: mouseEvent.pageX, y: mouseEvent.pageY }\n    : el\n    ? (({ x, y } = getRect(el)), { x, y })\n    : (undefined as any);\n\nlet rect: DOMRect;\nexport const getRect = <T extends Element | Nullish>(\n  el: T\n): ValueOrDefault<T, Rectangle> =>\n  el\n    ? ((rect = el.getBoundingClientRect()),\n      (pos = scrollPos(F)),\n      {\n        x: round(rect.left + pos.x),\n        y: round(rect.top + pos.y),\n        width: round(rect.width),\n        height: round(rect.height),\n      })\n    : (undefined as any);\n\ntype AllMaps = WindowEventMap &\n  GlobalEventHandlersEventMap &\n  DocumentEventMap &\n  HTMLElementEventMap;\n\nexport const listen = <K extends keyof AllMaps>(\n  el: any,\n  names: K[] | K,\n  cb: (ev: AllMaps[K], unbind: () => void) => void,\n  capture = T,\n  passive = T\n) => {\n  let unbinders: any[] = [];\n\n  return (\n    map(names, (name, i) => {\n      const mapped = (ev: any) => {\n        cb(ev, unbinders[i]);\n      };\n      push(unbinders, () => el.removeEventListener(name, mapped, capture));\n      return el.addEventListener(name, mapped, { capture, passive });\n    }),\n    () =>\n      unbinders.length > 0 && map(unbinders, (unbind) => unbind())\n        ? ((unbinders = []), T)\n        : F\n  );\n};\n\nexport const listenOnce = <K extends keyof AllMaps>(\n  el: any,\n  names: K[] | K,\n  cb: (event: AllMaps[K], unbind: () => void) => void,\n  useCapture?: boolean\n) =>\n  listen(\n    el,\n    names,\n    (event, unbind) => (cb(event, unbind), unbind()),\n    useCapture\n  );\n\nexport const parseDomain = <T extends string | Nullish>(\n  href: T\n): T extends string ? { domain?: Domain; href: string } : undefined =>\n  href == nil\n    ? (undefined as any)\n    : match(\n        href,\n        /^(?:([a-zA-Z0-9]+):)?(?:\\/\\/)?([^\\s\\/]*)/,\n        (all, protocol, domainName) =>\n          domainName\n            ? {\n                href: href.substring(all.length),\n                domain: {\n                  protocol,\n                  domainName,\n                } as Domain,\n              }\n            : { href }\n      );\n\nexport const getViewportSize = (): Size => ({\n  width: window.innerWidth,\n  height: window.innerHeight,\n});\n\nexport const getViewport = (): Viewport => (\n  (pos = scrollPos(T)),\n  {\n    ...pos,\n    width: window.innerWidth,\n    height: window.innerHeight,\n    totalWidth: body.offsetWidth,\n    totalHeight: body.offsetHeight,\n  }\n);\n\nexport const tryAsync = async <T, E = void>(\n  action: (() => Promise<T> | T) | Promise<T> | T,\n  error?: ((error: any) => Promise<E> | E) | Promise<E> | E,\n  always?: () => void | Promise<void>\n): Promise<T | E> => {\n  try {\n    return await (fun(action) ? action() : action);\n  } catch (e) {\n    console.error(e);\n    return await (fun(error) ? error(e) : e);\n  } finally {\n    await always?.();\n  }\n};\n\nexport const tryCatch = <T, R = undefined>(\n  action: () => T,\n  error: ((e: any) => R) | any[] | false = (e) => err(nil, nil, e) as R,\n  finallyCallback?: () => void\n): ConstToNormal<T | R | undefined> => {\n  const unbind = listen(window, \"error\", (ev) => ev.stopImmediatePropagation());\n  try {\n    return action() as any;\n  } catch (e) {\n    return error === F\n      ? undefined\n      : fun(error)\n      ? error(e)\n      : ((push(error, e) ?? err(nil, nil, e), undefined as R) as any);\n  } finally {\n    unbind();\n    finallyCallback?.();\n  }\n};\n"]}